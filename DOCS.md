# üìö KusokMedi Bot - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è v2.4

## üöÄ –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è (v2.4)

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ yt-dlp

**–ü—Ä–æ–≥—Ä–µ—Å—Å-—Ö—É–∫–∏ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:**
- –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ (MB/s)
- –¢–æ—á–Ω—ã–π ETA (–æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–∞–∂–¥—ã–µ 1.5 —Å–µ–∫—É–Ω–¥—ã
- Graceful handling —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:**
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∏–¥–µ–æ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 1 —á–∞—Å
- –°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ YouTube API
- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ç–µ–º –∂–µ –≤–∏–¥–µ–æ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–≥–æ –∫—ç—à–∞

**–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫: geo-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –≤–∏–¥–µ–æ, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- –î—Ä—É–∂–µ–ª—é–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Å–æ–≤–µ—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö

**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- –£–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª—É—á—à–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 4K, 2K, 1080p, 720p, 480p, 360p

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

**–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ yt_dlp.YoutubeDL:**
- –ó–∞–º–µ–Ω–∞ subprocess –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–π Python API
- –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –õ—É—á—à–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-—Ö—É–∫–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ä–∂–∏–Ω–≥ –≤–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ –±–µ–∑ FFmpeg

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤:**
- HTTP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ñ–∞–π–ª–æ–≤ >50MB
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (1 —á–∞—Å)
- Chunked reading –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Å—Å—ã–ª–∫–∏ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

**Backward compatibility:**
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É

---

## üìë –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è (v2.4)](#–Ω–æ–≤–∞—è-–ª–æ–≥–∏–∫–∞-—Å–∫–∞—á–∏–≤–∞–Ω–∏—è-v24)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–¥)
5. [API –º–æ–¥—É–ª–∏](#api-–º–æ–¥—É–ª–∏)
6. [–ö–æ–º–∞–Ω–¥—ã –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏](#–∫–æ–º–∞–Ω–¥—ã-–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏)
7. [–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—á–µ—Ä–µ–¥—å](#–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è-–æ—á–µ—Ä–µ–¥—å)
8. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (v2.2)](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º-v22)
9. [HTTP-—Å–µ—Ä–≤–µ—Ä](#http-—Å–µ—Ä–≤–µ—Ä)
10. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
11. [–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
12. [–ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞](#–ø—Ä–∏–º–µ—Ä—ã-–∫–æ–¥–∞)
13. [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
Telegram User ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ
                    ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ  Telegram API   ‚îÇ
            ‚îÇ  (Long Polling) ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ  src/bot.py     ‚îÇ
            ‚îÇ  (Main Handler) ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ            ‚îÇ            ‚îÇ
        ‚ñº            ‚ñº            ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇsrc/db  ‚îÇ   ‚îÇsrc/utils ‚îÇ  ‚îÇsrc/config‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ            ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                     ‚îÇ                ‚îÇ
                     ‚ñº                ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ  SQLite DB   ‚îÇ   ‚îÇ YouTube (yt-dlp)‚îÇ
            ‚îÇ  (users,     ‚îÇ   ‚îÇ FFmpeg (convert)‚îÇ
            ‚îÇ   downloads) ‚îÇ   ‚îÇ                 ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Background:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ queue_worker.py      ‚îÇ
‚îÇ (Daemon thread)      ‚îÇ
‚îÇ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ http_server.py       ‚îÇ
‚îÇ (–†–∞–∑–¥–∞—á–∞ –±–æ–ª—å—à–∏—Ö     ‚îÇ
‚îÇ  —Ñ–∞–π–ª–æ–≤ –ø–æ HTTP)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Python 3.9+** - –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫
- **pyTelegramBotAPI 4.14.0** - Telegram API –∫–ª–∏–µ–Ω—Ç (long-polling)
- **yt-dlp 2024.8.0+** - –∑–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ —Å YouTube (—Å –ø—Ä–æ–≥—Ä–µ—Å—Å-—Ö—É–∫–∞–º–∏)
- **SQLite3** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤ Python)
- **FFmpeg** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤)
- **threading** - –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å, —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- **http.server** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTTP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **bot.py** - –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ Telegram
2. **db.py** - SQLite wrapper, CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏, –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
3. **config.py** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
4. **utils.py** - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (yt-dlp, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
5. **queue_worker.py** - —Ñ–æ–Ω–æ–≤—ã–π worker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏
6. **http_server.py** - HTTP-—Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8765

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:**
- Python 3.9 –∏–ª–∏ –≤—ã—à–µ
- FFmpeg (Windows: `choco install ffmpeg`, macOS: `brew install ffmpeg`)
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–ª—è Telegram API –∏ YouTube

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:**
- Virtual environment (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- Git (–¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)

### –®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

#### 1. –°–∫–∞—á–∞—Ç—å/–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç

```bash
git clone <repo_url> KusokMedi
cd KusokMedi
```

#### 2. –°–æ–∑–¥–∞—Ç—å virtual environment

```bash
python -m venv venv
```

**Windows:**
```bash
venv\Scripts\activate
```

**macOS/Linux:**
```bash
source venv/bin/activate
```

#### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

#### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å bot

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `src/config.py`:

```python
# ============ TELEGRAM ============
TELEGRAM_TOKEN = "123456789:ABCdefGHIjklMNOpqrSTUvwxYZabcdefGHI"  # –û—Ç @BotFather
ADMIN_ID = 987654321  # –¢–≤–æ–π Telegram ID
BOT_USERNAME = "@YourBotName"

# ============ –û–ß–ï–†–ï–î–¨ –ò –ü–†–ò–û–†–ò–¢–ï–¢ ============
MAX_CONCURRENT_DOWNLOADS = 3
PRIORITY_DAYS = 365  # –î–Ω–µ–π –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ

# ============ –§–ê–ô–õ–´ ============
MAX_FILE_SIZE_MB = 50
MAX_VIDEO_DURATION_MINUTES = 120
MAX_STORAGE_MB = 10000

# ============ HTTP –°–ï–†–í–ï–† ============
HTTP_SERVER_ENABLED = True
HTTP_SERVER_PORT = 8765
```

#### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å FFmpeg –∏ yt-dlp

```bash
ffmpeg -version
yt-dlp --version
```

#### 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å

```bash
python main.py
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –ë–î –≤ `data/bot.db` —Å —Ç—Ä–µ–º—è —Ç–∞–±–ª–∏—Ü–∞–º–∏:

```python
# –í src/db.py - –º–µ—Ç–æ–¥ __init__
cursor.execute('''
    CREATE TABLE IF NOT EXISTS users (
        user_id INTEGER PRIMARY KEY,
        username TEXT,
        priority_until DATETIME,
        total_downloads INTEGER DEFAULT 0,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )
''')

cursor.execute('''
    CREATE TABLE IF NOT EXISTS downloads (
        download_id TEXT PRIMARY KEY,
        user_id INTEGER,
        video_url TEXT,
        status TEXT DEFAULT 'pending',
        progress INTEGER DEFAULT 0,
        file_path TEXT,
        error_message TEXT,
        started_at DATETIME,
        completed_at DATETIME,
        FOREIGN KEY(user_id) REFERENCES users(user_id)
    )
''')

cursor.execute('''
    CREATE TABLE IF NOT EXISTS priority_purchases (
        purchase_id TEXT PRIMARY KEY,
        user_id INTEGER,
        amount_usd REAL,
        status TEXT DEFAULT 'pending',
        created_at DATETIME,
        FOREIGN KEY(user_id) REFERENCES users(user_id)
    )
''')
```

### –¢–∞–±–ª–∏—Ü–∞: users

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|---------|
| `user_id` | INTEGER PRIMARY KEY | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `username` | TEXT | @username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram |
| `priority_until` | DATETIME | –î–∞—Ç–∞-–≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (NULL = –Ω–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞) |
| `total_downloads` | INTEGER | –í—Å–µ–≥–æ —Å–∫–∞—á–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ |
| `created_at` | DATETIME | –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ø–µ—Ä–≤—ã–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –±–æ—Ç |

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**

```sql
-- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–∫—Ç–∏–≤–Ω—ã–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
SELECT * FROM users WHERE priority_until > datetime('now');

-- –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
SELECT * FROM users WHERE user_id = 123456789;

-- –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ 30 –¥–Ω–µ–π
UPDATE users 
SET priority_until = datetime('now', '+30 days')
WHERE user_id = 123456789;

-- –ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
UPDATE users 
SET priority_until = NULL
WHERE user_id = 123456789;
```

### –¢–∞–±–ª–∏—Ü–∞: downloads

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|---------|
| `download_id` | TEXT PRIMARY KEY | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π UUID –∑–∞–≥—Ä—É–∑–∫–∏ |
| `user_id` | INTEGER | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–æ—Ç–æ—Ä—ã–π –∑–∞–≥—Ä—É–∂–∞–ª |
| `video_url` | TEXT | YouTube —Å—Å—ã–ª–∫–∞ |
| `status` | TEXT | pending/downloading/completed/failed |
| `progress` | INTEGER | 0-100% |
| `file_path` | TEXT | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –Ω–∞ –¥–∏—Å–∫–µ |
| `error_message` | TEXT | –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –µ—Å–ª–∏ –±—ã–ª –æ—Ç–∫–∞–∑ |
| `started_at` | DATETIME | –ö–æ–≥–¥–∞ –Ω–∞—á–∞–ª–∞—Å—å –∑–∞–≥—Ä—É–∑–∫–∞ |
| `completed_at` | DATETIME | –ö–æ–≥–¥–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –∑–∞–≥—Ä—É–∑–∫–∞ |

**–°—Ç–∞—Ç—É—Å—ã:**
- `pending` - –∂–¥–µ—Ç –≤ –æ—á–µ—Ä–µ–¥–∏
- `downloading` - –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å YouTube
- `completed` - –≥–æ—Ç–æ–≤–æ
- `failed` - –æ—à–∏–±–∫–∞

### –¢–∞–±–ª–∏—Ü–∞: priority_purchases

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|---------|
| `purchase_id` | TEXT PRIMARY KEY | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–∫—É–ø–∫–∏ |
| `user_id` | INTEGER | –ö—Ç–æ –∫—É–ø–∏–ª –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| `amount_usd` | REAL | –°—É–º–º–∞ –≤ USD |
| `status` | TEXT | pending/confirmed/rejected |
| `created_at` | DATETIME | –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–∫—É–ø–∫—É |

**–°—Ç–∞—Ç—É—Å—ã:**
- `pending` - –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥–º–∏–Ω–æ–º
- `confirmed` - –∞–¥–º–∏–Ω –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
- `rejected` - –∞–¥–º–∏–Ω –æ—Ç–∫–ª–æ–Ω–∏–ª

---

## API –º–æ–¥—É–ª–∏

### src/config.py

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**

```python
# –¢–æ–∫–µ–Ω –∏ –∞–¥–º–∏–Ω
TELEGRAM_TOKEN = "..."
ADMIN_ID = 123456789
BOT_USERNAME = "@BotName"

# –û—á–µ—Ä–µ–¥—å
MAX_CONCURRENT_DOWNLOADS = 3
PRIORITY_DAYS = 365

# –§–∞–π–ª—ã
MAX_FILE_SIZE_MB = 50
MAX_VIDEO_DURATION_MINUTES = 120
MAX_STORAGE_MB = 10000

# HTTP —Å–µ—Ä–≤–µ—Ä
HTTP_SERVER_ENABLED = True
HTTP_SERVER_PORT = 8765
HTTP_SERVER_TIMEOUT = 3600

# –ö–∞—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ
VIDEO_FORMATS = {
    '1080p': ('bestvideo[height=1080]', 'best'),
    '720p': ('bestvideo[height=720]', 'best'),
    '480p': ('bestvideo[height=480]', 'best'),
    '360p': ('bestvideo[height=360]', 'best'),
    'mp3': ('bestaudio', 'best'),
}

# –°–æ–æ–±—â–µ–Ω–∏—è (–≤—Å–µ —Å —ç–º–æ–¥–∑–∏)
MESSAGES = {
    'start': 'üëã –ü—Ä–∏–≤–µ—Ç! ...',
    'help': '‚ùì –°–ø—Ä–∞–≤–∫–∞: ...',
    # ... –∏ —Ç.–¥.
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```python
from src.config import TELEGRAM_TOKEN, ADMIN_ID

if user_id == ADMIN_ID:
    print("–≠—Ç–æ –∞–¥–º–∏–Ω")
```

### src/db.py

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π wrapper –¥–ª—è SQLite.

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

```python
db.add_user(user_id, username)  # –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
db.get_user(user_id)  # –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
db.has_priority(user_id)  # –ï—Å—Ç—å –ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç?
db.get_priority_duration(user_id)  # "30d 5h" —Ñ–æ—Ä–º–∞—Ç
```

#### –ó–∞–≥—Ä—É–∑–∫–∏

```python
db.add_download(user_id, video_url, quality)  # –°–æ–∑–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
db.update_download_status(download_id, status)  # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
db.update_download_progress(download_id, progress)  # 0-100%
db.get_pending_downloads()  # –ü–æ–ª—É—á–∏—Ç—å –æ—á–µ—Ä–µ–¥—å
```

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (v2.2)

```python
db.admin_give_priority(user_id, days)  # –ê–¥–º–∏–Ω –≤—ã–¥–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
db.admin_remove_priority(user_id)  # –ê–¥–º–∏–Ω –∑–∞–±–∏—Ä–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```python
from src.db import Database

db = Database()

# –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
db.add_user(123456789, "johndoe")

# –í—ã–¥–∞—Ç—å –µ–º—É –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ 30 –¥–Ω–µ–π
db.admin_give_priority(123456789, 30)

# –ü–æ–ª—É—á–∏—Ç—å –µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
duration = db.get_priority_duration(123456789)
print(f"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {duration}")  # "30d 0h"
```

### src/utils.py

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è YouTube –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–û–ë–ù–û–í–õ–ï–ù–ù–û –≤ v2.4):**

```python
# YouTube –æ–ø–µ—Ä–∞—Ü–∏–∏
is_youtube_url(url)  # True –µ—Å–ª–∏ YouTube —Å—Å—ã–ª–∫–∞
get_video_info(url)  # –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ –æ –≤–∏–¥–µ–æ (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
download_video(url, quality, output_path, progress_callback)  # –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-—Ö—É–∫–∞–º–∏

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
format_duration(seconds)  # "1:23:45"
format_speed(bytes_per_sec)  # "2.3 MB/s"
format_eta(seconds)  # "00:05:30"
format_file_size(bytes)  # "123.4 MB"
```

**–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ v2.4:**

- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:** `get_video_info()` –∫—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ 1 —á–∞—Å
- **–ü—Ä–æ–≥—Ä–µ—Å—Å-—Ö—É–∫–∏:** `download_video()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç yt_dlp.YoutubeDL —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ (geo-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –≤–∏–¥–µ–æ)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ä–∂–∏–Ω–≥:** –í–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –±–µ–∑ FFmpeg

**–ü—Ä–∏–º–µ—Ä:**

```python
from src.utils import is_youtube_url, get_video_info, download_video

if is_youtube_url("https://www.youtube.com/watch?v=abc"):
    # –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
    info = get_video_info("https://www.youtube.com/watch?v=abc")
    print(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {info['title']}")
    print(f"–î–ª–∏–Ω–∞: {info['duration']} —Å–µ–∫")

    # –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
    def progress_callback(stage, pct, speed, eta, downloaded, total):
        print(f"{stage}: {pct}% at {speed} MB/s, ETA: {eta}s")

    success, file_path, metadata = download_video(
        "https://www.youtube.com/watch?v=abc",
        "/tmp",
        "1080p",
        progress_callback
    )
```

### src/queue_worker.py

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –§–æ–Ω–æ–≤—ã–π worker –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–≥—Ä—É–∑–æ–∫.

**–ö–ª–∞—Å—Å: QueueWorker**

```python
class QueueWorker:
    def __init__(self):
        self.is_running = False
        self.thread = None
        self.active_downloads = 0
        
    def start(self):  # –ó–∞–ø—É—Å—Ç–∏—Ç—å worker
    def stop(self):   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å worker
```

**–ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
2. –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ < MAX_CONCURRENT_DOWNLOADS
3. –ü–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∏–∑ –æ—á–µ—Ä–µ–¥–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–Ω–∞—á–∞–ª–∞)
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
5. –û–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –ë–î
6. –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### src/http_server.py

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** HTTP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (>50MB).

**–ö–ª–∞—Å—Å: HTTPFileServer**

```python
class HTTPFileServer:
    def __init__(self, port=8765):
        self.port = port
        self.server = None
        
    def start(self):  # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
    def stop(self):   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
    def get_file_url(self, file_path):  # –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª
```

**–ü—Ä–∏–º–µ—Ä:**

```python
from src.http_server import HTTPFileServer

http = HTTPFileServer(port=8765)
http.start()

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞
url = http.get_file_url("/path/to/video.mp4")
print(f"–°–∫–∞—á–∏–≤–∞–π: {url}")  # http://localhost:8765/file/...
```

### src/bot.py

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥.

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

```python
# –ö–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
@bot.message_handler(commands=['start'])
def process_start(message): ...

@bot.message_handler(commands=['help'])
def process_help(message): ...

@bot.message_handler(commands=['status'])
def process_status(message): ...

# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (v2.2)
@bot.message_handler(commands=['admin'])
def process_admin(message): ...

@bot.message_handler(commands=['give_priority'])
def process_give_priority(message): ...

@bot.message_handler(commands=['remove_priority'])
def process_remove_priority(message): ...

# –û–±—Ä–∞–±–æ—Ç–∫–∞ URL
@bot.message_handler(func=lambda message: is_youtube_url(message.text))
def process_url(message): ...

# Callback –∫–Ω–æ–ø–æ–∫
@bot.callback_query_handler(func=lambda call: True)
def callback_handler(call): ...
```

---

## –ö–æ–º–∞–Ω–¥—ã –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

### –ö–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### /start

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫:** `process_start(message)`

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ë–î
2. –ï—Å–ª–∏ –Ω–µ—Ç - –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ö–æ–¥:**

```python
@bot.message_handler(commands=['start'])
def process_start(message):
    user_id = message.from_user.id
    username = message.from_user.username
    
    db.add_user(user_id, username)
    
    msg = MESSAGES['start']
    bot.send_message(user_id, msg)
```

#### /help

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫:** `process_help(message)`

**–î–µ–π—Å—Ç–≤–∏–µ:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º

#### /status

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫:** `process_status(message)`

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏
2. –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Ç–∞—Ç—É—Å –µ–≥–æ –∑–∞–≥—Ä—É–∑–æ–∫

**–í—ã–≤–æ–¥:**
```
üìä –°—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏:
- –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫: 2
- –í –æ—á–µ—Ä–µ–¥–∏: 5
- –¢–≤–æ–∏ –∑–∞–≥—Ä—É–∑–∫–∏: 1
- –¢–≤–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω (30 –¥–Ω–µ–π)
- –•—Ä–∞–Ω–∏–ª–∏—â–µ: 1234.5 MB
```

#### /buy_priority

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫:** `process_buy_priority(message)`

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–∫—É–ø–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ priority_purchases
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á—Ç–æ –Ω—É–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–æ–º
3. –ê–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

#### /admin

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫:** `process_admin(message)`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ `message.from_user.id == ADMIN_ID`

**–î–µ–π—Å—Ç–≤–∏–µ:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å –∫–Ω–æ–ø–∫–∞–º–∏:
- "üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞—Ç–µ–∂–µ–π"
- "üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã"
- "üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ"

#### /give_priority

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫:** `process_give_priority(message)`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–¥–º–∏–Ω

**–§–æ—Ä–º–∞—Ç:**
```
/give_priority
<user_id> <days>

/give_priority
123456789 30

/give_priority
987654321 -1
```

**–î–µ–π—Å—Ç–≤–∏–µ (v2.2 –û–ë–ù–û–í–õ–ï–ù–ù–û):**
1. –ü–∞—Ä—Å–∏—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π
2. **–ï—Å–ª–∏ days < 0** ‚Üí –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç **–ë–ï–°–ö–û–ù–ï–ß–ù–´–ô** (‚àû)
3. **–ï—Å–ª–∏ user_id == ADMIN_ID** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–∞–µ—Ç –≤–µ—á–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–¥–∞–∂–µ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –¥–Ω–∏)
4. –í—ã–∑—ã–≤–∞–µ—Ç `db.admin_give_priority(user_id, days)`
5. –û–±–Ω–æ–≤–ª—è–µ—Ç `priority_until` –≤ —Ç–∞–±–ª–∏—Ü–µ users (–∏–ª–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç "INFINITE")
6. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
7. –õ–æ–≥–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ –≤ logs/bot.log

**–ü—Ä–∏–º–µ—Ä—ã:**
```
/give_priority
123456789 30       # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ 30 –¥–Ω–µ–π

/give_priority
987654321 -1       # –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (‚àû)

/give_priority
555555555 -999     # –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ª—é–±–æ–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ)
``` –≤ logs/bot.log

**–ö–æ–¥:**

```python
@bot.message_handler(commands=['give_priority'])
def process_give_priority(message):
    if message.from_user.id != ADMIN_ID:
        return
    
    # –ü—Ä–∏–º–µ—Ä: "/give_priority" + "\n123456789 30"
    text = message.text.split('\n')[1] if '\n' in message.text else ""
    parts = text.split()
    
    if len(parts) != 2:
        bot.send_message(ADMIN_ID, "‚ùå –§–æ—Ä–º–∞—Ç: <ID> <–¥–Ω–∏>")
        return
    
    user_id = int(parts[0])
    days = int(parts[1])
    
    db.admin_give_priority(user_id, days)
    
    # –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    bot.send_message(user_id, MESSAGES['priority_given'])
    bot.send_message(ADMIN_ID, f"‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
```

#### /remove_priority

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫:** `process_remove_priority(message)`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–¥–º–∏–Ω

**–§–æ—Ä–º–∞—Ç:**
```
/remove_priority
<user_id>

/remove_priority
123456789
```

**–î–µ–π—Å—Ç–≤–∏–µ (v2.2):**
1. –ü–∞—Ä—Å–∏—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –í—ã–∑—ã–≤–∞–µ—Ç `db.admin_remove_priority(user_id)`
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `priority_until = NULL` –≤ —Ç–∞–±–ª–∏—Ü–µ users
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
```
‚ö†Ô∏è –ü–†–ò–û–†–ò–¢–ï–¢ –û–¢–û–ó–í–ê–ù

üòî –¢–≤–æ–π VIP —Å—Ç–∞—Ç—É—Å –±—ã–ª –æ—Ç–æ–∑–≤–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.
‚ö° –¢–≤–æ–∏ –≤–∏–¥–µ–æ —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –æ–±—â–µ–π –æ—á–µ—Ä–µ–¥–∏.
```
5. –õ–æ–≥–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ

#### /list_priority

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫:** `handle_list_priority(message)`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–¥–º–∏–Ω

**–§–æ—Ä–º–∞—Ç:**
```
/list_priority
```

**–î–µ–π—Å—Ç–≤–∏–µ (–ù–û–í–û–ï –≤ v2.2):**
1. –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–∫—Ç–∏–≤–Ω—ã–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
2. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏—Ö –≤ –∫—Ä–∞—Å–∏–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
   - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ ID Telegram
   - –¢–∏–ø –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (–≤—Ä–µ–º—è –∏–ª–∏ ‚àû –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π)
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∑–æ–∫
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º

**–í—ã–≤–æ–¥:**
```
üìã –°–ü–ò–°–û–ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô –° –ü–†–ò–û–†–ò–¢–ï–¢–û–ú

1. John Doe @johndoe
   ID: 123456789
   –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: 30–¥ 5—á
   –ó–∞–≥—Ä—É–∑–æ–∫: 15

2. Admin User @admin
   ID: 987654321
   –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ‚àû –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π
   –ó–∞–≥—Ä—É–∑–æ–∫: 42

–í—Å–µ–≥–æ: 2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ—á–µ—Ä–µ–¥—å

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞

–ü–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –æ—á–µ—Ä–µ–¥–∏:

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** (—É –∫–æ—Ç–æ—Ä—ã—Ö `priority_until > now`)
2. **–û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** (–ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –ë–î)

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–í queue_worker.py:**

```python
def get_next_download(self):
    # –ü–æ–ª—É—á–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
    priority_downloads = db.connection.execute('''
        SELECT downloads.* FROM downloads
        JOIN users ON downloads.user_id = users.user_id
        WHERE downloads.status = 'pending'
        AND users.priority_until > datetime('now')
        ORDER BY downloads.created_at
        LIMIT 1
    ''').fetchall()
    
    if priority_downloads:
        return priority_downloads[0]
    
    # –ï—Å–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –Ω–µ—Ç, –ø–æ–ª—É—á–∏—Ç—å –æ–±—ã—á–Ω—ã–µ
    regular_downloads = db.connection.execute('''
        SELECT * FROM downloads
        WHERE status = 'pending'
        ORDER BY created_at
        LIMIT 1
    ''').fetchall()
    
    return regular_downloads[0] if regular_downloads else None
```

### –ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è

**–°–∏—Ç—É–∞—Ü–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê (–æ–±—ã—á–Ω—ã–π) –¥–æ–±–∞–≤–∏–ª –≤–∏–¥–µ–æ –≤ 10:00
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë (–æ–±—ã—á–Ω—ã–π) –¥–æ–±–∞–≤–∏–ª –≤–∏–¥–µ–æ –≤ 10:05
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –í (–ü–†–ò–û–†–ò–¢–ï–¢) –¥–æ–±–∞–≤–∏–ª –≤–∏–¥–µ–æ –≤ 10:07

**–û—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
1. ‚úÖ –í (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
2. ‚è≥ –ê (–æ–±—ã—á–Ω—ã–π)
3. ‚è≥ –ë (–æ–±—ã—á–Ω—ã–π)

**–ï—Å–ª–∏ –í –¥–æ–±–∞–≤–∏—Ç –µ—â–µ –æ–¥–Ω–æ –≤–∏–¥–µ–æ –≤ 10:10:**
1. ‚úÖ –í (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –ø–µ—Ä–≤–æ–µ –≤–∏–¥–µ–æ)
2. ‚úÖ –í (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –≤—Ç–æ—Ä–æ–µ –≤–∏–¥–µ–æ)
3. ‚è≥ –ê (–æ–±—ã—á–Ω—ã–π)
4. ‚è≥ –ë (–æ–±—ã—á–Ω—ã–π)

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (v2.2)

### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ db.py

#### admin_give_priority(user_id, days)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—ã–¥–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞ N –¥–Ω–µ–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (int) - Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `days` (int) - –ù–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π. –ï—Å–ª–∏ < 0 ‚Üí –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

**–î–µ–π—Å—Ç–≤–∏–µ (–û–ë–ù–û–í–õ–ï–ù–ù–û –≤ v2.2):**
1. –ï—Å–ª–∏ `days < 0` ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `priority_until = "INFINITE"`
2. –ï—Å–ª–∏ `days >= 0` ‚Üí –≤—ã—á–∏—Å–ª—è–µ—Ç –¥–∞—Ç—É: now + N –¥–Ω–µ–π
3. –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª–µ `priority_until` –≤ —Ç–∞–±–ª–∏—Ü–µ users
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ

**–ü—Ä–∏–º–µ—Ä—ã:**
```python
db.admin_give_priority(123456789, 30)   # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ 30 –¥–Ω–µ–π
db.admin_give_priority(987654321, -1)   # –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
db.admin_give_priority(555555555, 365)  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ 1 –≥–æ–¥
```

#### admin_remove_priority(user_id)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (int) - Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–î–µ–π—Å—Ç–≤–∏–µ:**
1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `priority_until = NULL`
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ –æ–±—ã—á–Ω—É—é –æ—á–µ—Ä–µ–¥—å
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ

**–ö–æ–¥:**

```python
def admin_remove_priority(self, user_id):
    with self.lock:
        cursor = self.connection.cursor()
        
        cursor.execute('''
            UPDATE users 
            SET priority_until = NULL
            WHERE user_id = ?
        ''', (user_id,))
        
        self.connection.commit()
        return cursor.rowcount > 0
```

#### get_priority_duration(user_id)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –≤ –∫—Ä–∞—Å–∏–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (int) - Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `str` - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ "30–¥ 5—á", "‚àû –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π", –∏–ª–∏ None –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞

**–ü—Ä–∏–º–µ—Ä—ã (–û–ë–ù–û–í–õ–ï–ù–ù–û –≤ v2.2):**
- `get_priority_duration(123)` ‚Üí `"30–¥ 5—á"`
- `get_priority_duration(456)` ‚Üí `"0–¥ 2—á"` (2 —á–∞—Å–∞)
- `get_priority_duration(789)` ‚Üí `"‚àû –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π"` (INFINITE)
- `get_priority_duration(999)` ‚Üí `None` (–Ω–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)

### –ü–æ—Ç–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º

**–í—ã–¥–∞—á–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:**

```
–ê–¥–º–∏–Ω –≤–≤–æ–¥–∏—Ç:
/give_priority
123456789 30
    ‚îÇ
    ‚ñº
process_give_priority() –ø–∞—Ä—Å–∏—Ç
    ‚îÇ
    ‚ñº
db.admin_give_priority(123456789, 30)
    ‚îÇ
    ‚ñº
UPDATE users SET priority_until = now + 30 days
    ‚îÇ
    ‚ñº
bot.send_message(123456789, "üéâ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã–¥–∞–Ω...")
    ‚îÇ
    ‚ñº
log("Admin gave priority to 123456789 for 30 days")
```

**–û—Ç–∑—ã–≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:**

```
–ê–¥–º–∏–Ω –≤–≤–æ–¥–∏—Ç:
/remove_priority
123456789
    ‚îÇ
    ‚ñº
process_remove_priority() –ø–∞—Ä—Å–∏—Ç
    ‚îÇ
    ‚ñº
db.admin_remove_priority(123456789)
    ‚îÇ
    ‚ñº
UPDATE users SET priority_until = NULL
    ‚îÇ
    ‚ñº
bot.send_message(123456789, "‚ö†Ô∏è –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–æ–∑–≤–∞–Ω...")
    ‚îÇ
    ‚ñº
log("Admin removed priority from 123456789")
```

#### get_users_with_priority()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–∫—Ç–∏–≤–Ω—ã–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –ù–µ—Ç

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `List[Dict]` - –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ —Ç–∏–ø—É –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (INFINITE –ø–µ—Ä–≤—ã–º–∏)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ª–æ–≤–∞—Ä—è:**
```python
{
    "user_id": 123456789,
    "username": "johndoe",
    "first_name": "John",
    "priority_until": "‚àû –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π",  # –∏–ª–∏ –¥–∞—Ç–∞ "2025-01-15T10:30:00"
    "total_downloads": 15
}
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
users = db.get_users_with_priority()
for user in users:
    print(f"{user['first_name']} (@{user['username']}): {user['priority_until']}")
```

---

## HTTP-—Å–µ—Ä–≤–µ—Ä

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–†–∞–∑–¥–∞–≤–∞—Ç—å —Ñ–∞–π–ª—ã >50MB —á–µ—Ä–µ–∑ HTTP, —Ç–∞–∫ –∫–∞–∫ Telegram API –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç –≤ 50MB.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏–º–µ—Ä:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–¥–µ–æ 100MB
2. BotAPI –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ Telegram
3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ `storage/123456/video.mp4`
4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É: `http://localhost:8765/file/abc123def456`
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
# src/config.py
HTTP_SERVER_ENABLED = True
HTTP_SERVER_HOST = "0.0.0.0"  # –°–ª—É—à–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö
HTTP_SERVER_PORT = 8765
HTTP_SERVER_TIMEOUT = 3600  # –°—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤—É–µ—Ç 1 —á–∞—Å
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

```python
from src.http_server import HTTPFileServer

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤ main.py
http_server = HTTPFileServer()
http_server.start()

# –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏
file_size = os.path.getsize(file_path)
if file_size > MAX_FILE_SIZE_MB * 1024 * 1024:
    # –ë–æ–ª—å—à–æ–π —Ñ–∞–π–ª - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ HTTP
    url = http_server.get_file_url(file_path)
    bot.send_message(user_id, f"üì• –°–∫–∞—á–∏–≤–∞–π: {url}")
else:
    # –ú–∞–ª–µ–Ω—å–∫–∏–π —Ñ–∞–π–ª - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é
    with open(file_path, 'rb') as f:
        bot.send_document(user_id, f)
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `storage/` –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–º —Å –≤–µ–±–∞
- ‚úÖ –°—Å—ã–ª–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –¢–∞–π–º–∞—É—Ç 1 —á–∞—Å (–ø–æ—Ç–æ–º —Å—Å—ã–ª–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–∫–∞—á–∏–≤–∞–Ω–∏–π

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø—ã –æ—à–∏–±–æ–∫ (–û–ë–ù–û–í–õ–ï–ù–ù–û –≤ v2.4)

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|--------|
| `video_geo_blocked` | –í–∏–¥–µ–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –≤ —Ä–µ–≥–∏–æ–Ω–µ | –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å VPN –∏–ª–∏ –¥—Ä—É–≥–æ–µ –≤–∏–¥–µ–æ |
| `video_private` | –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –≤–∏–¥–µ–æ | –°–æ–æ–±—â–∏—Ç—å —á—Ç–æ –≤–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ |
| `video_unavailable` | –í–∏–¥–µ–æ —É–¥–∞–ª–µ–Ω–æ –∏–ª–∏ —Å–∫—Ä—ã—Ç–æ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Å—ã–ª–∫—É |
| `VideoNotFound` | –í–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ | –°–æ–æ–±—â–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é |
| `DownloadTimeout` | –í–∏–¥–µ–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è >30 –º–∏–Ω—É—Ç | –û—Ç–º–µ–Ω–∏—Ç—å, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –º–µ–Ω—å—à–µ –∫–∞—á–µ—Å—Ç–≤–æ |
| `ConversionError` | FFmpeg –æ—à–∏–±–∫–∞ | –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ |
| `StorageFull` | –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–æ | –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã |
| `DatabaseError` | –û—à–∏–±–∫–∞ –ë–î | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å |

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –∫–æ–¥–µ (–û–ë–ù–û–í–õ–ï–ù–ù–û –≤ v2.4)

```python
# –í src/utils.py - download_video()
try:
    # –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å yt_dlp.YoutubeDL
    success, file_path, metadata = download_video(url, output_path, format_type, progress_callback)

    if not success:
        error_type = metadata.get("error")
        if error_type == "video_geo_blocked":
            return False, None, {"error": "üåç –í–∏–¥–µ–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ\nüí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ VPN"}
        elif error_type == "video_private":
            return False, None, {"error": "üîí –≠—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ –≤–∏–¥–µ–æ"}
        elif error_type == "video_unavailable":
            return False, None, {"error": "üö´ –í–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ"}
        else:
            return False, None, {"error": f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {metadata.get('error', 'Unknown')}"}

except Exception as e:
    logging.error(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
    return False, None, {"error": f"üî¥ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {str(e)[:100]}"}

# –í src/bot.py - –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
def get_friendly_error_message(error_msg):
    if "geo_blocked" in error_msg:
        return "‚ùå –û–®–ò–ë–ö–ê –ó–ê–ì–†–£–ó–ö–ò\n\nüåç –í–∏–¥–µ–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ\nüí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ VPN –∏–ª–∏ –¥—Ä—É–≥–æ–µ –≤–∏–¥–µ–æ"
    elif "private" in error_msg:
        return "‚ùå –û–®–ò–ë–ö–ê –ó–ê–ì–†–£–ó–ö–ò\n\nüîí –≠—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ –≤–∏–¥–µ–æ\nüí° –ê–≤—Ç–æ—Ä —Å–¥–µ–ª–∞–ª –µ–≥–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞"
    elif "unavailable" in error_msg:
        return "‚ùå –û–®–ò–ë–ö–ê –ó–ê–ì–†–£–ó–ö–ò\n\nüö´ –í–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ\nüí° –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ –∏–ª–∏ —Å–∫—Ä—ã—Ç–æ"
    elif "timeout" in error_msg.lower():
        return "‚ùå –û–®–ò–ë–ö–ê –ó–ê–ì–†–£–ó–ö–ò\n\n‚è∞ –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è\nüí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω—å—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ"
    else:
        return f"‚ùå –û–®–ò–ë–ö–ê –ó–ê–ì–†–£–ó–ö–ò\n\n‚ö†Ô∏è {error_msg}\nüí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É"
```

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§–∞–π–ª –ª–æ–≥–æ–≤

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `logs/bot.log`

**–§–æ—Ä–º–∞—Ç:**
```
[2024-01-15 10:30:45] INFO: User 123456 started bot
[2024-01-15 10:31:12] INFO: User 123456 queued download of https://youtube.com/...
[2024-01-15 10:32:00] INFO: Download 123456_abc started
[2024-01-15 10:35:45] INFO: Download 123456_abc completed (45.2 MB)
[2024-01-15 10:36:00] ERROR: Download failed: timeout
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (v2.2)

```
[2024-01-15 12:00:00] ADMIN: Admin (7563861429) gave priority to user 123456 for 30 days
[2024-01-15 12:05:00] ADMIN: User 123456 received notification: "üéâ –ü–†–ò–û–†–ò–¢–ï–¢ –í–´–î–ê–ù –ê–î–ú–ò–ù–û–ú!"
[2024-01-15 12:10:00] ADMIN: Admin (7563861429) removed priority from user 123456
[2024-01-15 12:10:05] ADMIN: User 123456 received notification: "‚ö†Ô∏è –ü–†–ò–û–†–ò–¢–ï–¢ –û–¢–û–ó–í–ê–ù"
```

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

- `DEBUG` - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `INFO` - –û–±—ã—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (—Å—Ç–∞—Ä—Ç, –∑–∞–≥—Ä—É–∑–∫–∞, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)
- `WARNING` - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–º–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª)
- `ERROR` - –û—à–∏–±–∫–∏ (—Ç–∞–π–º–∞—É—Ç, –æ—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏)
- `CRITICAL` - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ (–ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)

---

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –ü—Ä–∏–º–µ—Ä 1: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—ã–¥–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

```python
from src.db import Database
from datetime import datetime, timedelta

db = Database()

# –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_id = 123456789
username = "johndoe"
db.add_user(user_id, username)

# –í—ã–¥–∞—Ç—å –µ–º—É –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ 30 –¥–Ω–µ–π
db.admin_give_priority(user_id, 30)

# –ü–æ–ª—É—á–∏—Ç—å –µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
duration = db.get_priority_duration(user_id)
print(f"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {duration}")  # "30d 0h"

# –ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
db.admin_remove_priority(user_id)
duration = db.get_priority_duration(user_id)
print(f"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {duration}")  # "–ù–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞"
```

### –ü—Ä–∏–º–µ—Ä 2: –°–æ–∑–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥—å

```python
from src.db import Database

db = Database()

# –°–æ–∑–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
download_id = db.add_download(
    user_id=123456789,
    video_url="https://www.youtube.com/watch?v=abc123",
    quality="720p"
)

# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ–∂–∏–¥–∞—é—â–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
pending = db.get_pending_downloads()
for download in pending:
    print(f"ID: {download['download_id']}")
    print(f"URL: {download['video_url']}")
    print(f"Status: {download['status']}")

# –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
db.update_download_status(download_id, 'downloading')

# –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
db.update_download_progress(download_id, 50)  # 50%

# –ó–∞–≤–µ—Ä—à–∏—Ç—å
db.update_download_status(download_id, 'completed')
```

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

```python
from src.db import Database

db = Database()

# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
all_users = db.connection.execute(
    "SELECT * FROM users"
).fetchall()

# –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
priority_users = db.connection.execute(
    "SELECT * FROM users WHERE priority_until > datetime('now')"
).fetchall()

# –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏
active = db.connection.execute(
    "SELECT * FROM downloads WHERE status = 'downloading'"
).fetchall()

print(f"–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {len(all_users)}")
print(f"–° –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º: {len(priority_users)}")
print(f"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫: {len(active)}")
```

---

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "Token is not a string"

**–ü—Ä–∏—á–∏–Ω–∞:** `TELEGRAM_TOKEN` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ config.py

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä—ã—Ç—å `src/config.py`
2. –ó–∞–º–µ–Ω–∏—Ç—å `TELEGRAM_TOKEN = "..."` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
3. –¢–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ: `"123456789:ABCdefGHIjklMNOpqrSTUvwxYZabcdefGHI"`

### –ü—Ä–æ–±–ª–µ–º–∞: "ffmpeg not found"

**–ü—Ä–∏—á–∏–Ω–∞:** FFmpeg –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –Ω–µ –≤ PATH

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# Windows (—Å Chocolatey)
choco install ffmpeg

# macOS (—Å Homebrew)
brew install ffmpeg

# Linux (Ubuntu/Debian)
sudo apt-get install ffmpeg

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
ffmpeg -version
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Database is locked"

**–ü—Ä–∏—á–∏–Ω–∞:** SQLite –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª—É –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `data/bot.db` –Ω–µ –æ—Ç–∫—Ä—ã—Ç–∞ –≤ –¥—Ä—É–≥–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ - –≤—ã–ø–æ–ª–Ω–∏—Ç—å: `icacls "data/bot.db" /grant:r %USERNAME%:F`
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞: "yt-dlp error"

**–ü—Ä–∏—á–∏–Ω–∞:** yt-dlp –Ω–µ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ

**–†–µ—à–µ–Ω–∏–µ:**
1. –û–±–Ω–æ–≤–∏—Ç—å yt-dlp: `pip install --upgrade yt-dlp`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–∏–¥–µ–æ –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ YouTube

### –ü—Ä–æ–±–ª–µ–º–∞: "Connection timeout from Telegram"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç —Å–≤—è–∑–∏ —Å Telegram API

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ @BotFather –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç
4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ë–î –Ω–æ –Ω–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `priority_until`

**–†–µ—à–µ–Ω–∏–µ:**
```python
from src.db import Database

db = Database()

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ –ë–î
user = db.connection.execute(
    "SELECT * FROM users WHERE user_id = 123456789"
).fetchone()

print(f"priority_until: {user['priority_until']}")

# –ï—Å–ª–∏ NULL –∏–ª–∏ –≤ –ø—Ä–æ—à–ª–æ–º - –≤—ã–¥–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
db.admin_give_priority(123456789, 30)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
duration = db.get_priority_duration(123456789)
print(f"–¢–µ–ø–µ—Ä—å: {duration}")
```

---

**KusokMedi Bot v2.4** - –ü–æ–ª–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úÖ